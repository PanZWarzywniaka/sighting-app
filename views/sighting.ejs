<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <link rel='stylesheet' href='/stylesheets/style.css'/>
    <script src="/javascripts/chat.js"></script>
</head>
<!--Will get users username from cookie-->
<% let username = `User${Math.round(Math.random() * 10000)}`%>
<body onload="init(<%= JSON.stringify(data) %>,'<%=username%>')">
<h1><%= title  %></h1>
<div id="chat_interface" >
    <div>
        <div id="who_you_are" style="display: inline"></div> Chat for <%=data.username%>'s sighting: <div id="in_room" style="display: inline"></div>
    </div>
    <br>
    <div id="history" style="overflow-y: scroll; width: 100%; height: 400px; border: blue solid 1px; position: relative;"   class="boxed">
        <table id="chat_history" style="width: 100%;">
            <% for(let i=0; i<chats.length; i++) {%>
                <tr>
                    <% let datetime = new Date(chats[i].created_at) %>
                    <% let date = datetime.toLocaleDateString() %>
                    <% let time = datetime.toLocaleTimeString('default', {hour:"numeric",minute:"numeric"}) %>
<!--                    Will change username to 'me' if username in cookie same as current username-->
                    <td><%= chats[i].username%></td>
                    <td style="word-break: break-all;"><%= chats[i].message%></td>
                    <td><%= `${date} ${time}` %></td>
                </tr>
            <% } %>
        </table>
        <div id="input" style=" width: 100%; position: absolute; bottom: 10px;" class="bottom boxed">
            <form onsubmit="return false;" style="width: 100%">
                <p>
                    <label for="name"> chat: </label>
                    <input type="text" id="chat_input" name="chat_input" style="width: 80%">
                    <button id="chat_send" onclick="sendChatText()">Send</button>
                </p>
            </form>
        </div>
    </div>


</div>
</body>
</html>